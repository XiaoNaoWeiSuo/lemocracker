# 柠檬吧数据爬虫工具

一个功能完整的交互式爬虫程序，用于采集柠檬吧共享充电宝站点数据。

## 功能特性

- 🎯 **交互式操作**: 友好的数字菜单界面，无需记忆命令参数
- 🚀 **多城市并发采集**: 支持24个主要城市同时采集
- ⚙️ **灵活配置**: 可在运行时修改所有采集参数
- 🔐 **自定义认证**: 支持动态设置Authorization头
- 💾 **数据管理**: SQLite数据库存储，支持CSV导出
- 📊 **实时统计**: 显示采集进度和数据库统计信息
- 🛡️ **防护机制**: 内置请求间隔和超时保护

## 安装使用

### 1. 编译程序

```bash
# 安装依赖
go mod tidy

# 编译为可执行文件
go build -o lemobar-crawler main.go
```

### 2. 运行程序

```bash
# 直接运行进入交互界面
./lemobar-crawler
```

## 主菜单功能

程序启动后会显示主菜单，包含以下选项：

```
==================================================
           柠檬吧数据爬虫工具 v2.0
==================================================
1. 开始数据采集
2. 导出数据到CSV
3. 查看当前配置
4. 修改配置
5. 查看数据库统计
6. 帮助说明
0. 退出程序
==================================================
```

### 功能说明

| 选项 | 功能 | 说明 |
|------|------|------|
| 1 | 开始数据采集 | 启动多城市并发数据采集 |
| 2 | 导出数据到CSV | 将数据库数据导出为CSV文件 |
| 3 | 查看当前配置 | 显示当前所有配置参数 |
| 4 | 修改配置 | 进入配置菜单修改采集参数 |
| 5 | 查看数据库统计 | 显示数据库记录数和城市分布 |
| 6 | 帮助说明 | 显示详细的使用说明 |
| 0 | 退出程序 | 安全退出程序 |

## 配置参数

在 "4. 修改配置" 菜单中可以设置以下参数：

| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| Authorization | 认证头值 (必需) | 无 | `36e443b22b61942fd817beb4c05d1a0dd` |
| 请求间隔 | 两次请求间的等待时间 | 200ms | `500ms`, `1s` |
| 采集时长 | 每个城市的最大采集时间 | 30m | `1h`, `2h` |
| 最大采集数 | 每个城市最多采集位置点数量 | 5000 | `10000`, `20000` |
| 数据库文件 | SQLite数据库文件路径 | lemobar_scan.db | `data.db` |
| 导出文件 | CSV导出文件路径 | lemobar_export.csv | `export.csv` |

## 使用流程

### 首次使用

1. 运行程序: `./lemobar-crawler`
2. 选择 "4" 进入配置菜单
3. 选择 "1" 设置 Authorization 头值
4. 返回主菜单，选择 "1" 开始采集

### 日常使用

1. 运行程序
2. 选择 "3" 查看当前配置
3. 选择 "1" 开始采集 或 "2" 导出数据

## 数据输出

### SQLite数据库
- 文件: `lemobar_scan.db` (可配置)
- 表: `lemobar_areas`
- 字段: area_id, area_name, detail_address, latitude, longitude, total_device_num, free_device_num, wait_duration

### CSV导出文件
- 文件: `lemobar_export.csv` (可配置)
- 格式: 标准CSV，包含表头
- 编码: UTF-8

## 支持的城市

程序支持以下24个主要城市的数据采集：

北京、上海、广州、深圳、杭州、南京、成都、重庆、武汉、西安、天津、苏州、郑州、长沙、青岛、宁波、佛山、合肥、无锡、厦门、大连、南昌、昆明、常州

## 采集策略

- **螺旋式扫描**: 从城市中心向外螺旋扫描
- **并发处理**: 24个城市同时进行采集
- **智能去重**: 自动忽略重复的数据记录
- **双重限制**: 支持时间限制和数量限制
- **错误恢复**: 自动重试失败的请求

## 注意事项

### 🔐 Authorization获取
1. 打开柠檬吧微信小程序
2. 使用浏览器开发者工具或抓包工具
3. 查找API请求中的 Authorization 头值
4. 复制完整的令牌值到程序中

### ⚡ 性能建议
- 请求间隔不要低于200ms，避免被限制
- 大量采集时建议设置较长的采集时长
- 确保有足够的磁盘空间存储数据

### 🛠️ 故障排除

**"必须先设置 Authorization 头值"**
- 在主菜单选择 "4 → 1" 设置Authorization

**"API decode failed or code!=200"**
- 检查Authorization是否有效
- 适当增加请求间隔时间

**数据库相关错误**
- 确保程序有文件读写权限
- 检查磁盘空间是否充足

## 跨平台编译

使用提供的构建脚本生成跨平台可执行文件：

```bash
# 生成所有平台的可执行文件
./build.sh

# 可执行文件将生成在 build/ 目录中:
# - lemobar-crawler-windows-amd64.exe (Windows)
# - lemobar-crawler-linux-amd64 (Linux)
# - lemobar-crawler-macos-amd64 (macOS Intel)
# - lemobar-crawler-macos-arm64 (macOS Apple Silicon)
```

## 开发信息

- **语言**: Go 1.24+
- **依赖**: github.com/mattn/go-sqlite3
- **架构**: 交互式命令行界面
- **许可**: MIT License

## 更新日志

- **v2.0**: 完整的交互式界面，用户友好的菜单操作
- **v1.0**: 命令行参数版本
